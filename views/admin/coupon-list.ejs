<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from techzaa.in/larkon/admin/coupons-list.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 03 Dec 2024 05:43:31 GMT -->
<head>
     <!-- Title Meta -->
     <meta charset="utf-8" />
     <title>Coupons | Larkon - Responsive Admin Dashboard Template</title>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta name="description" content="A fully responsive premium admin dashboard template" />
     <meta name="author" content="Techzaa" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge" />

     <!-- App favicon -->
     <link rel="shortcut icon" href="images/favicon.ico">

     <!-- Vendor css (Require in all Page) -->
     <link href="css/vendor.min.css" rel="stylesheet" type="text/css" />

     <!-- Icons css (Require in all Page) -->
     <link href="css/icons.min.css" rel="stylesheet" type="text/css" />

     <!-- App css (Require in all Page) -->
     <link href="css/app.min.css" rel="stylesheet" type="text/css" />

     <!-- Theme Config js (Require in all Page) -->
     <script src="js/config.js"></script>
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
     <style>
     .display-none {
          display: none;
     }
     .short-swal-popup {
          width: 300px; 
          padding: 0;
          font-size: 15px;
     }

     .short-swal-content {
          font-size: 15px;
          margin: 0; 
          padding: 0; 
     }

     .short-swal-confirm-btn {
          padding: 5px 10px;
          font-size: 15px;
          border-radius: 4px;
     }

     .short-swal-cancel-btn {
          padding: 5px 10px;
          font-size: 15px;
          border-radius: 4px;
     }

     
     .swal2-actions {
          gap: 5px; 
     }

     .swal2-icon.swal2-error {
          display: flex;
          align-items: center;
          justify-content: center;
          width: 30px; 
          height: 30px;
          margin: 0; 
          font-size: 15px;
          line-height: 30px; 
     }

     .swal2-icon.swal2-error::before {
          content: 'âœ–'; 
          color: red;
     }

     .compact-swal-popup {
          width: auto !important; 
          height: auto !important; 
          padding: 20px 20px !important;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 8px;
     }
     .swal2-title {
          font-size: 18px !important;
          margin: 0 !important;
          line-height: 1.5 !important;
     }


     .swal2-html-container {
          margin: 0 !important; 
     }

     .swal2-timer-progress-bar {
      height: 2px !important;
     }
     </style>
</head>

<body>

     <!-- START Wrapper -->
     <div class="wrapper">

          <!-- ========== Topbar Start ========== -->
          <%- include('../partials/admin/header') %>

          <!-- Right Sidebar (Theme Settings) -->
          <%- include('../partials/admin/theme') %>
          <!-- ========== Topbar End ========== -->

          <!-- ========== App Menu Start ========== -->
          <%- include('../partials/admin/nav') %>
          <!-- ========== App Menu End ========== -->

          <!-- ==================================================== -->
          <!-- Start right Content here -->
          <!-- ==================================================== -->
          <div class="page-content">

               <!-- Start Container Fluid -->
               <div class="container-xxl">

                    <div class="row d-none">
                         <div class="col-lg-12">
                              <div class="card bg-light-subtle">
                                   <div class="card-header border-0">
                                        <div class="row justify-content-between">
                                             <div class="col-lg-6">
                                                  <div class="row align-items-center">
                                                       <div class="col-lg-6">
                                                            <form class="app-search d-none d-md-block me-auto">
                                                                 <div class="position-relative">
                                                                      <input type="search" class="form-control" placeholder="Search Coupons and Code" autocomplete="off" value="">
                                                                      <iconify-icon icon="solar:magnifer-broken" class="search-widget-icon"></iconify-icon>
                                                                 </div>
                                                            </form>
                                                       </div>
                                                       <div class="col-lg-4">
                                                            <h5 class="text-dark fw-medium mb-0">5,786 <span class="text-muted">Items</span></h5>
                                                       </div>
                                                  </div>
                                             </div>
                                             <div class="col-lg-6">
                                                  <div class="text-md-end mt-3 mt-md-0">
                                                       <button type="button" class="btn btn-outline-secondary me-1"><i class="bx bx-cog me-1"></i>More Setting</button>
                                                       <button type="button" class="btn btn-outline-secondary me-1"><i class="bx bx-filter-alt me-1"></i> Filters</button>
                                                       <button type="button" class="btn btn-success me-1"><i class="bx bx-plus"></i> New Coupons</button>
                                                  </div>
                                             </div><!-- end col-->
                                        </div>
                                   </div>
                              </div>
                         </div>
                    </div>

                    <div class="row">
                         <div class="col-xl-12">
                              <div class="card">
                                   <div class="card-header d-flex justify-content-between align-items-center gap-1">
                                        <h4 class="card-title flex-grow-1">All Coupon List</h4>

                                        <a href="/admin/addCoupon" class="btn btn-sm btn-primary">
                                             Add Coupon
                                        </a>
                                   </div>
                                        <div class="table-responsive">
                                             <table class="table align-middle mb-0 table-hover table-centered">
                                                  <thead class="bg-light-subtle">
                                                       <tr>
                                                            <th style="width: 20px;">
                                                                 <div class="form-check">
                                                                      <input type="checkbox" class="form-check-input" id="customCheck1">
                                                                      <label class="form-check-label" for="customCheck1"></label>
                                                                 </div>
                                                            </th>
                                                            <th>Code</th>
                                                            <th>Min Cart Price</th>
                                                            <th>Discount type</th>
                                                            <th>Discount</th>
                                                            <th>Start Date</th>
                                                            <th>End Date</th>
                                                            <th>Status</th>
                                                            <th>Action</th>
                                                       </tr>
                                                  </thead>
                                                  <tbody>
                                                       <% if(coupon.length>0) { %>
                                                       <% for(let i = 0; i<coupon.length; i++) { %>
                                                       <tr>
                                                            <td>
                                                                 <div class="form-check">
                                                                      <input type="checkbox" class="form-check-input" id="customCheck2">
                                                                      <label class="form-check-label" for="customCheck2">&nbsp;</label>
                                                                 </div>
                                                            </td>
                                                            <td><%= coupon[i].code %></td>
                                                            <td><%= coupon[i].minCartValue %></td>
                                                            <td><%= coupon[i].couponType %></td>
                                                            <td><%= coupon[i].discountValue %></td>
                                                            <td class="convert-date" data-date="<%= coupon[i].startDate %>"></td>
                                                            <td class="convert-date" data-date="<%= coupon[i].endDate %>"></td>
                                                            <td>
                                                                 <% if(coupon[i].couponStatus === 'active') { %>
                                                                      <span id="activeStatus<%= i %>" class="badge text-success bg-success-subtle fs-12"><i class="bx bx-check-double"></i>Active</span>
                                                                      <span id="inactiveStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12 display-none"><i class="bx bx-x"></i>Inactive</span>
                                                                      <span id="expiredStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12 display-none"><i class="bx bx-x"></i>Expired</span>
                                                                 <% } else if(coupon[i].couponStatus === 'inactive') { %>   
                                                                      <span id="activeStatus<%= i %>" class="badge text-success bg-success-subtle fs-12 display-none"><i class="bx bx-check-double"></i>Active</span>
                                                                      <span id="inactiveStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12"><i class="bx bx-x"></i>Inactive</span>
                                                                      <span id="expiredStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12 display-none"><i class="bx bx-x"></i>Expired</span>
                                                                 <% } else if(coupon[i].couponStatus === 'expired') { %>
                                                                      <span id="activeStatus<%= i %>" class="badge text-success bg-success-subtle fs-12 display-none"><i class="bx bx-check-double"></i>Active</span>
                                                                      <span id="inactiveStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12 display-none"><i class="bx bx-x"></i>Inactive</span>
                                                                      <span id="expiredStatus<%= i %>" class="badge text-danger bg-danger-subtle fs-12"><i class="bx bx-x"></i>Expired</span>
                                                                 <% } %>     
                                                            </td>
                                                            <td>
                                                                 <% if(coupon[i].couponStatus !== 'expired') { %>
                                                                 <div class="d-flex gap-2">
                                                                 <% if(coupon[i].couponStatus === 'inactive') { %>
                                                                      <button id="activeBtn<%= i %>" class="btn btn-success" onclick="changeStatus(event, '<%= coupon[i]._id %>', 'active', '<%= i %>')" type="button">active</button>
                                                                      <button id="inactiveBtn<%= i %>" class="btn btn-danger display-none" onclick="changeStatus(event, '<%= coupon[i]._id %>', 'inactive', '<%= i %>')" type="button">inactive</button>
                                                                 <% } else if(coupon[i].couponStatus === 'active') { %>
                                                                      <button id="activeBtn<%= i %>" class="btn btn-success display-none" onclick="changeStatus(event, '<%= coupon[i]._id %>', 'active', '<%= i %>')" type="button">active</button>
                                                                      <button id="inactiveBtn<%= i %>" class="btn btn-danger" onclick="changeStatus(event, '<%= coupon[i]._id %>', 'inactive', '<%= i %>')" type="button">inactive</button>
                                                                 <% }} %>
                                                                 </div>
                                                            </td>
                                                       </tr>
                                                       <% }} %>
                                                  </tbody>
                                             </table>
                                        </div>
                                        <!-- end table-responsive -->
                                   </div>
                                   <div class="card-footer border-top">
                                        <nav aria-label="Page navigation example">
                                             <ul class="pagination justify-content-end mb-0">
                                                  <% if(currentPage > 1) { %>
                                                       <li class="page-item"><a class="page-link" href="?page=<%= currentPage - 1 %>">Previous</a></li>
                                                  <% } else { %>
                                                       <li class="page-item disabled"><a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a></li>
                                                  <% } %> 
                                                  <% for(let i = 1; i<= totalPages; i++) { if(i == currentPage) { %>
                                                       <li class="page-item active"><a class="page-link"><%= i %></a></li>
                                                  <% } else { %>
                                                       <li class="page-item"><a class="page-link" href="?page=<%= i %>"><%= i %></a></li>
                                                  <% }} if(currentPage < totalPages) { %>
                                                       <li class="page-item"><a class="page-link" href="?page=<%= Number(currentPage) + 1 %>">Next</a></li>
                                                  <% } else { %>
                                                       <li class="page-item disabled"><a class="page-link" tabindex="-1" aria-disabled="true" href="#">Next</a></li>
                                                  <% } %>
                                             </ul>
                                        </nav>
                                   </div>
                              </div>
                         </div>

                    </div>

               </div>
               <!-- End Container Fluid -->

               <!-- ========== Footer Start ========== -->
               <%- include('../partials/admin/footer') %>
               <!-- ========== Footer End ========== -->

          </div>
          <!-- ==================================================== -->
          <!-- End Page Content -->
          <!-- ==================================================== -->

     </div>
     <!-- END Wrapper -->

     <!-- Vendor Javascript (Require in all Page) -->
     <script src="js/vendor.js"></script>

     <!-- App Javascript (Require in all Page) -->
     <script src="js/app.js"></script>
     <script>
          function covertDate(element, newDate) {
               const date = new Date(newDate);
               const convertedDate = date.getDate() +  " " + date.toLocaleString('default', { month: 'short' }) + " " + date.getFullYear();
               element.innerHTML = convertedDate;
          }
          document.addEventListener('DOMContentLoaded', () => {
               const dateElem = document.querySelectorAll('.convert-date');
               dateElem.forEach((element) => {
                    const date = element.getAttribute('data-date');
                    covertDate(element, date);
               });
          });
          
          // function for change coupon status 
          function changeStatus(event, id, value, i) {
               event.preventDefault();
               if(!id || !value) {
                    return
               }
               if(value === 'inactive') {
                    Swal.fire({
                         position: "top-end",
                         title: 'Are you sure you want to inactive this coupon?',
                         showCancelButton: true,
                         confirmButtonColor: '#3085d6',
                         cancelButtonColor: '#d33',
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No',
                         customClass: {
                              popup: 'short-swal-popup',
                              confirmButton: 'short-swal-confirm-btn',
                              cancelButton: 'short-swal-cancel-btn'
                         }
                    })
                    .then(result => {
                         if(result.isConfirmed) {
                              fetchFunction(id, value, i);
                         }
                    });
               } else {
                    Swal.fire({
                         position: "top-end",
                         title: 'Are you sure you want to active this coupon?',
                         showCancelButton: true,
                         confirmButtonColor: '#3085d6',
                         cancelButtonColor: '#d33',
                         confirmButtonText: 'Yes',
                         cancelButtonText: 'No',
                         customClass: {
                              popup: 'short-swal-popup',
                              confirmButton: 'short-swal-confirm-btn',
                              cancelButton: 'short-swal-cancel-btn'
                         }
                    })
                    .then(result => {
                         if(result.isConfirmed) {
                              fetchFunction(id, value, i);
                         }
                    })
               }
               
          }
          async function fetchFunction(id, value, i) {
               try {
                    const response = await fetch(`/admin/changeCouponStatus?id=${id}&value=${value}`, {method: 'PATCH'});
                    const data = await response.json();
                    if(!response.ok) {
                         throw new Error(data.message);
                    }
                    if(data.success) {
                         if(data.value === 'active') {
                              document.getElementById('activeBtn'+i).style.display = 'none';
                              document.getElementById('inactiveStatus'+i).style.display = 'none';
                              document.getElementById('expiredStatus'+i).style.display = 'none';
                              document.getElementById('inactiveBtn'+i).style.display = 'block';
                              document.getElementById('activeStatus'+i).style.display = 'block';
                         } else {
                              document.getElementById('inactiveBtn'+i).style.display = 'none';
                              document.getElementById('activeStatus'+i).style.display = 'none';
                              document.getElementById('expiredStatus'+i).style.display = 'none';
                              document.getElementById('activeBtn'+i).style.display = 'block';
                              document.getElementById('inactiveStatus'+i).style.display = 'block';
                         }
                    }
               } catch (error) {
                    Swal.fire({
                         position: "top-end",
                         html: `
                              <div style="display: flex; align-items: center; gap: 10px;">
                                   <div>
                                        <div class="swal2-icon swal2-error" style="width: 30px; height: 30px; margin: 0; font-size: 16px;"></div>
                                   </div>
                                   <div style="font-size: 20px; text-align: left;">Oops... ${error.message}</div>
                              </div>
                         `,
                         showConfirmButton: false,
                         timer: 1500,
                         customClass: {
                              popup: 'compact-swal-popup',
                         }
                    });
               }
          }

          async function logout() {
          try {
               const response = await fetch('/admin/logout', {method: 'POST'})
               const data = await response.json();
               if(!response.ok) {
                    throw new Error(data.message);
               }
               if(data.success) {
                    window.location.href = '/admin/login'
               }
          } catch (error) {
               Swal.fire({
                    position: "top-end",
                    icon: "error",
                    title: "Oops...",
                    text: error.message,
                    showConfirmButton: false,
                    timer: 1500,
                    customClass: {
                         popup: 'custom-swal-popup'
                    }
               });
          }
     }

     document.getElementById('logout-btn').addEventListener('click', logout);
     </script>

</body>


<!-- Mirrored from techzaa.in/larkon/admin/coupons-list.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 03 Dec 2024 05:43:31 GMT -->
</html>